---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(rpart)
library(rpart.plot)
library(tidyverse)
library(neuralnet)
clean_lead <- read_csv(file.path("clean_lead.csv"),
                          col_types=cols(
                            geo_id = readr::col_factor(),
                            state_id = readr::col_factor(),
                            county_id = readr::col_factor(),
                            tract_id = readr::col_factor(),
                            puma10_code = readr::col_factor(),
                            fmr_code = readr::col_factor(),
                            occupancy_type = readr::col_factor(),
                            income_bracket = readr::col_factor(),
                            primary_heating_fuel = readr::col_factor(),
                            number_of_units = readr::col_factor(),
                            year_constructed = readr::col_factor(),
                            households = col_double(),
                            annual_income = col_double(),
                            electricity_spend = col_double(),
                            gas_spend = col_double(),
                            other_spend = col_double(),
                            acs_responses = col_double(),
                            min_age = col_double(),
                            min_units = col_double(),
                            detached = readr::col_factor(),
                            mean_energy_cost = col_double(),
                            mean_energy_burden = col_double(),
                            energy_poverty = col_logical()
                            ))

#all(data_reloaded == data, na.rm=TRUE)
```


```{r}
# Creates training and testing data sets

set.seed(2)
smp_size <- floor(0.8 * nrow(clean_lead))
train_ind <- sample(seq_len(nrow(clean_lead)), size = smp_size)
data_train <- clean_lead[train_ind,]
data_test <- clean_lead[-train_ind,]

dim(data_train)

#prop.table(table(data_train$primary_heating_fuel))

prop.table(table(data_train$energy_poverty))
prop.table(table(data_test$energy_poverty))
```


```{r}
#data_train
subset_predictors = c("occupancy_type", "primary_heating_fuel", "annual_income", "mean_energy_burden", "electricity_spend", "gas_spend", "other_spend", "min_age", "min_units", "detached", "energy_poverty", "mean_energy_cost")
data_train_subset = data_train[, subset_predictors]
data_test_subset = data_test[, subset_predictors]
```

```{r}
#rpart.control(minsplit = 20, minbucket = round(0/3), maxdepth = 30)
fit = rpart(energy_poverty~.-mean_energy_burden, data = data_train_subset, method = 'class')
rpart.plot(fit, extra = 106)
summary(fit)

# Error rate
sum(predict(fit, data_test_subset, type='class') != data_test_subset$energy_poverty)/nrow(data_test_subset)
```


```{r}
fit = rpart(energy_poverty~.-annual_income -mean_energy_burden, data = data_train_subset, method = 'class')
rpart.plot(fit, extra = 106)
summary(fit)

# Error rate
sum(predict(fit, data_test_subset, type='class') != data_test_subset$energy_poverty)/nrow(data_test_subset)
```

```{r}
fit = rpart(energy_poverty~.-annual_income -mean_energy_burden -mean_energy_cost, data = data_train_subset, method = 'class')
rpart.plot(fit, extra = 106)
summary(fit)

# Error rate
sum(predict(fit, data_test_subset, type='class') != data_test_subset$energy_poverty)/nrow(data_test_subset)
```


```{r}
fit = rpart(primary_heating_fuel~., data = data_train_subset, method = 'class')
rpart.plot(fit, extra = 106)
summary(fit)
```


```{r}
subset_predictors = c("occupancy_type", "primary_heating_fuel", "electricity_spend", "gas_spend", "other_spend", "min_age", "min_units", "detached", "mean_energy_burden")
data_train_subset = data_train[, subset_predictors]
data_test_subset = data_test[, subset_predictors]

tree = rpart(mean_energy_burden~., data = data_train_subset, method = 'anova')
rpart.plot(tree, extra = 100)
summary(tree)
```


```{r}
RMSE = mean((data_test_subset$mean_energy_burden - predict(tree, data_test_subset))^2) %>% sqrt()
RMSE
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

