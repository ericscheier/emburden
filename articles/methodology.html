<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Net Energy Return Methodology • emburden</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Net Energy Return Methodology">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">emburden</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/methodology.html">Methodology</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/jss-emburden.html">JSS Package Manuscript</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ericscheier/emburden"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Net Energy Return Methodology</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ericscheier/emburden/blob/main/vignettes/methodology.Rmd" class="external-link"><code>vignettes/methodology.Rmd</code></a></small>
      <div class="d-none name"><code>methodology.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ericscheier/emburden" class="external-link">emburden</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette explains the mathematical foundations of the Net Energy
Return (Nh) methodology for analyzing household energy burden. We’ll
show why this approach is both theoretically sound and computationally
advantageous for aggregation across households.</p>
</div>
<div class="section level2">
<h2 id="the-problem-aggregating-ratios">The Problem: Aggregating Ratios<a class="anchor" aria-label="anchor" href="#the-problem-aggregating-ratios"></a>
</h2>
<p>Energy burden is defined as the ratio of energy spending to gross
income:</p>
<p><strong>Energy Burden (EB) = S / G</strong></p>
<p>Where: - <strong>S</strong> = Total energy spending (electricity +
gas + other fuels) - <strong>G</strong> = Gross household income</p>
<p>While this definition is straightforward for a single household,
<strong>aggregating energy burden across multiple households is not
trivial</strong>.</p>
<div class="section level3">
<h3 id="why-arithmetic-mean-fails">Why Arithmetic Mean Fails<a class="anchor" aria-label="anchor" href="#why-arithmetic-mean-fails"></a>
</h3>
<p>Consider three households:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Three households with different income/spending patterns</span></span>
<span><span class="va">households</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30000</span>, <span class="fl">50000</span>, <span class="fl">100000</span><span class="op">)</span>,</span>
<span>  spending <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3000</span>, <span class="fl">3500</span>, <span class="fl">4000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">households</span><span class="op">$</span><span class="va">eb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy_burden_func.html">energy_burden_func</a></span><span class="op">(</span><span class="va">households</span><span class="op">$</span><span class="va">income</span>, <span class="va">households</span><span class="op">$</span><span class="va">spending</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">households</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id income spending   eb</span></span>
<span><span class="co">#&gt; 1  1  3e+04     3000 0.10</span></span>
<span><span class="co">#&gt; 2  2  5e+04     3500 0.07</span></span>
<span><span class="co">#&gt; 3  3  1e+05     4000 0.04</span></span></code></pre></div>
<p>What is the “average” energy burden across these three
households?</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Attempt 1: Simple arithmetic mean (WRONG!)</span></span>
<span><span class="va">mean_eb_wrong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">households</span><span class="op">$</span><span class="va">eb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Simple mean EB:"</span>, <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">mean_eb_wrong</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Simple mean EB: 7%"</span></span></code></pre></div>
<p>This is incorrect because it treats all households equally, ignoring
that they represent different amounts of total income and spending.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Attempt 2: Weighted arithmetic mean (STILL WRONG!)</span></span>
<span><span class="co"># Let's weight by number of households (all equal here, but principle matters)</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">150</span>, <span class="fl">200</span><span class="op">)</span>  <span class="co"># Different household counts</span></span>
<span></span>
<span><span class="va">eb_arithmetic_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">households</span><span class="op">$</span><span class="va">eb</span>, <span class="va">weights</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Weighted arithmetic mean EB:"</span>, <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">eb_arithmetic_mean</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Weighted arithmetic mean EB: 6%"</span></span></code></pre></div>
<p><strong>Why is this still wrong?</strong> Energy burden is a ratio,
and ratios cannot be aggregated using arithmetic means. The correct
approach requires the <strong>harmonic mean</strong>.</p>
</div>
<div class="section level3">
<h3 id="the-correct-approach-harmonic-mean">The Correct Approach: Harmonic Mean<a class="anchor" aria-label="anchor" href="#the-correct-approach-harmonic-mean"></a>
</h3>
<p>For ratios like energy burden, the mathematically correct aggregation
uses the harmonic mean:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correct aggregation: Weighted harmonic mean</span></span>
<span><span class="va">eb_harmonic</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">households</span><span class="op">$</span><span class="va">eb</span>, <span class="va">weights</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Weighted harmonic mean EB:"</span>, <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">eb_harmonic</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Weighted harmonic mean EB: 6%"</span></span>
<span></span>
<span><span class="co"># Verify by calculating from totals</span></span>
<span><span class="va">total_spending</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">households</span><span class="op">$</span><span class="va">spending</span> <span class="op">*</span> <span class="va">weights</span><span class="op">)</span></span>
<span><span class="va">total_income</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">households</span><span class="op">$</span><span class="va">income</span> <span class="op">*</span> <span class="va">weights</span><span class="op">)</span></span>
<span><span class="va">eb_from_totals</span> <span class="op">&lt;-</span> <span class="va">total_spending</span> <span class="op">/</span> <span class="va">total_income</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"EB from totals:"</span>, <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">eb_from_totals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "EB from totals: 5%"</span></span>
<span></span>
<span><span class="co"># These should be identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Difference:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">eb_harmonic</span> <span class="op">-</span> <span class="va">eb_from_totals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Difference: 0.00198446937014668"</span></span></code></pre></div>
<p>The harmonic mean gives the same result as calculating energy burden
from the aggregated totals, which is what we want!</p>
</div>
</div>
<div class="section level2">
<h2 id="the-solution-net-energy-return-nh">The Solution: Net Energy Return (Nh)<a class="anchor" aria-label="anchor" href="#the-solution-net-energy-return-nh"></a>
</h2>
<p>While the harmonic mean is correct, it has some practical drawbacks:
1. <strong>Computational complexity</strong>: Requires division by each
individual EB value 2. <strong>Numerical instability</strong>: Very
small EB values (e.g., 0.01) become very large (100) after inversion 3.
<strong>Less intuitive</strong>: Harmonic means are less familiar to
most analysts 4. <strong>Error-prone</strong>: Easy to accidentally use
arithmetic mean instead</p>
<p>The Net Energy Return (Nh) transformation solves these issues.</p>
<div class="section level3">
<h3 id="mathematical-relationship">Mathematical Relationship<a class="anchor" aria-label="anchor" href="#mathematical-relationship"></a>
</h3>
<p>Net Energy Return is defined as:</p>
<p><strong>Nh = (G - S) / S</strong></p>
<p>This represents “net energy return per unit of energy spending” -
similar to concepts in biophysical economics.</p>
<p><strong>Key insight</strong>: Nh can be aggregated using simple
arithmetic mean, then converted back to energy burden!</p>
<p>Let’s verify the mathematical relationship:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Starting from Nh = (G - S) / S</span></span>
<span><span class="co"># Let's solve for EB = S / G</span></span>
<span></span>
<span><span class="co"># Nh = (G - S) / S</span></span>
<span><span class="co"># Nh = G/S - S/S</span></span>
<span><span class="co"># Nh = G/S - 1</span></span>
<span><span class="co"># Nh + 1 = G/S</span></span>
<span><span class="co"># 1 / (Nh + 1) = S/G = EB</span></span>
<span></span>
<span><span class="co"># Therefore: EB = 1 / (Nh + 1)</span></span>
<span></span>
<span><span class="co"># Verify with our example</span></span>
<span><span class="va">households</span><span class="op">$</span><span class="va">nh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ner_func.html">ner_func</a></span><span class="op">(</span><span class="va">households</span><span class="op">$</span><span class="va">income</span>, <span class="va">households</span><span class="op">$</span><span class="va">spending</span><span class="op">)</span></span>
<span><span class="va">households</span><span class="op">$</span><span class="va">eb_from_nh</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">households</span><span class="op">$</span><span class="va">nh</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare to original EB</span></span>
<span><span class="va">households</span><span class="op">$</span><span class="va">identical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">households</span><span class="op">$</span><span class="va">eb</span>, <span class="va">households</span><span class="op">$</span><span class="va">eb_from_nh</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">households</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"eb"</span>, <span class="st">"eb_from_nh"</span>, <span class="st">"nh"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id   eb eb_from_nh       nh</span></span>
<span><span class="co">#&gt; 1  1 0.10       0.10  9.00000</span></span>
<span><span class="co">#&gt; 2  2 0.07       0.07 13.28571</span></span>
<span><span class="co">#&gt; 3  3 0.04       0.04 24.00000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aggregation-via-arithmetic-mean">Aggregation via Arithmetic Mean<a class="anchor" aria-label="anchor" href="#aggregation-via-arithmetic-mean"></a>
</h3>
<p>Now we can aggregate using simple arithmetic mean:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Calculate Nh for each household</span></span>
<span><span class="va">nh_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ner_func.html">ner_func</a></span><span class="op">(</span><span class="va">households</span><span class="op">$</span><span class="va">income</span>, <span class="va">households</span><span class="op">$</span><span class="va">spending</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Arithmetic weighted mean (simple!)</span></span>
<span><span class="va">nh_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">nh_values</span>, <span class="va">weights</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Weighted mean Nh:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">nh_mean</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Weighted mean Nh: 17.1"</span></span>
<span></span>
<span><span class="co"># Step 3: Convert back to EB</span></span>
<span><span class="va">eb_from_nh</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">nh_mean</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"EB from Nh method:"</span>, <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">eb_from_nh</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "EB from Nh method: 6%"</span></span>
<span></span>
<span><span class="co"># Compare to harmonic mean result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"EB from harmonic mean:"</span>, <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">eb_harmonic</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "EB from harmonic mean: 6%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Difference:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">eb_from_nh</span> <span class="op">-</span> <span class="va">eb_harmonic</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Difference: 0"</span></span></code></pre></div>
<p><strong>Result</strong>: Both methods give identical results, but the
Nh method uses simple arithmetic mean instead of harmonic mean!</p>
</div>
</div>
<div class="section level2">
<h2 id="why-this-works-the-mathematics">Why This Works: The Mathematics<a class="anchor" aria-label="anchor" href="#why-this-works-the-mathematics"></a>
</h2>
<p>The key mathematical insight is that the Nh transformation linearizes
the aggregation problem.</p>
<p>For a group of households with weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>i</mi></msub><annotation encoding="application/x-tex">w_i</annotation></semantics></math>,
incomes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>G</mi><mi>i</mi></msub><annotation encoding="application/x-tex">G_i</annotation></semantics></math>,
and spending
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>S</mi><mi>i</mi></msub><annotation encoding="application/x-tex">S_i</annotation></semantics></math>:</p>
<p><strong>Harmonic mean approach</strong>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">EB</mtext><mtext mathvariant="normal">agg</mtext></msub><mo>=</mo><mfrac><mn>1</mn><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>⋅</mo><mfrac><mn>1</mn><msub><mtext mathvariant="normal">EB</mtext><mi>i</mi></msub></mfrac></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>⋅</mo><mfrac><msub><mi>G</mi><mi>i</mi></msub><msub><mi>S</mi><mi>i</mi></msub></mfrac></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{EB}_{\text{agg}} = \frac{1}{\sum_i w_i \cdot \frac{1}{\text{EB}_i}} = \frac{1}{\sum_i w_i \cdot \frac{G_i}{S_i}}</annotation></semantics></math></p>
<p><strong>Nh approach</strong>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">Nh</mtext><mtext mathvariant="normal">mean</mtext></msub><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Nh</mtext><mi>i</mi></msub><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>⋅</mo><mfrac><mrow><msub><mi>G</mi><mi>i</mi></msub><mo>−</mo><msub><mi>S</mi><mi>i</mi></msub></mrow><msub><mi>S</mi><mi>i</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">\text{Nh}_{\text{mean}} = \sum_i w_i \cdot \text{Nh}_i = \sum_i w_i \cdot \frac{G_i - S_i}{S_i}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">EB</mtext><mtext mathvariant="normal">agg</mtext></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msub><mtext mathvariant="normal">Nh</mtext><mtext mathvariant="normal">mean</mtext></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{EB}_{\text{agg}} = \frac{1}{1 + \text{Nh}_{\text{mean}}}</annotation></semantics></math></p>
<p>Both formulations are mathematically equivalent when computing from
the same underlying data.</p>
</div>
<div class="section level2">
<h2 id="computational-advantages-for-aggregation">Computational Advantages (For Aggregation)<a class="anchor" aria-label="anchor" href="#computational-advantages-for-aggregation"></a>
</h2>
<p>The Nh method provides several advantages <strong>when aggregating
across multiple households</strong>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate larger dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">large_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">n</span>, meanlog <span class="op">=</span> <span class="fl">10.8</span>, sdlog <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>,  <span class="co"># Log-normal income distribution</span></span>
<span>  spending <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="op">)</span></span>
<span><span class="va">large_data</span><span class="op">$</span><span class="va">spending</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">n</span>, meanlog <span class="op">=</span> <span class="fl">8.2</span>, sdlog <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,  <span class="co"># Log-normal spending</span></span>
<span>  <span class="va">large_data</span><span class="op">$</span><span class="va">income</span> <span class="op">*</span> <span class="fl">0.5</span>  <span class="co"># Cap at 50% of income</span></span>
<span><span class="op">)</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">50</span><span class="op">:</span><span class="fl">500</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Method 1: Nh with arithmetic mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">nh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ner_func.html">ner_func</a></span><span class="op">(</span><span class="va">large_data</span><span class="op">$</span><span class="va">income</span>, <span class="va">large_data</span><span class="op">$</span><span class="va">spending</span><span class="op">)</span></span>
<span>  <span class="va">nh_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">nh</span>, <span class="va">weights</span><span class="op">)</span></span>
<span>  <span class="va">eb_nh</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">nh_mean</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.000   0.000   0.001</span></span>
<span></span>
<span><span class="co"># Method 2: Harmonic mean</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">eb_direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy_burden_func.html">energy_burden_func</a></span><span class="op">(</span><span class="va">large_data</span><span class="op">$</span><span class="va">income</span>, <span class="va">large_data</span><span class="op">$</span><span class="va">spending</span><span class="op">)</span></span>
<span>  <span class="va">eb_harmonic</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">eb_direct</span>, <span class="va">weights</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.000   0.000   0.001</span></span>
<span></span>
<span><span class="co"># Verify results are identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"EB via Nh:"</span>, <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">eb_nh</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "EB via Nh: 5%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"EB via harmonic mean:"</span>, <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">eb_harmonic</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "EB via harmonic mean: 5%"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Difference:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">eb_nh</span> <span class="op">-</span> <span class="va">eb_harmonic</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Difference: 0"</span></span></code></pre></div>
<p><strong>Note</strong>: The computational advantage applies
specifically to <strong>aggregation across households</strong>. For
single household calculations, both methods are equivalent (EB = S/G =
1/(1+Nh)) and require the same basic operations.</p>
<div class="section level3">
<h3 id="numerical-stability">Numerical Stability<a class="anchor" aria-label="anchor" href="#numerical-stability"></a>
</h3>
<p>The Nh method is also more numerically stable:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Households with very low energy burden</span></span>
<span><span class="va">low_burden</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200000</span>, <span class="fl">500000</span>, <span class="fl">1000000</span><span class="op">)</span>,</span>
<span>  spending <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">3000</span>, <span class="fl">5000</span><span class="op">)</span>  <span class="co"># Very low spending relative to income</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">low_burden</span><span class="op">$</span><span class="va">eb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/energy_burden_func.html">energy_burden_func</a></span><span class="op">(</span><span class="va">low_burden</span><span class="op">$</span><span class="va">income</span>, <span class="va">low_burden</span><span class="op">$</span><span class="va">spending</span><span class="op">)</span></span>
<span><span class="va">low_burden</span><span class="op">$</span><span class="va">nh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ner_func.html">ner_func</a></span><span class="op">(</span><span class="va">low_burden</span><span class="op">$</span><span class="va">income</span>, <span class="va">low_burden</span><span class="op">$</span><span class="va">spending</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Energy Burden (direct):"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Energy Burden (direct):"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">low_burden</span><span class="op">$</span><span class="va">eb</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.010 0.006 0.005</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"\nReciprocal of EB (used in harmonic mean):"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "\nReciprocal of EB (used in harmonic mean):"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">low_burden</span><span class="op">$</span><span class="va">eb</span><span class="op">)</span>  <span class="co"># Very large numbers!</span></span>
<span><span class="co">#&gt; [1] 100.0000 166.6667 200.0000</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"\nNet Energy Return (Nh):"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "\nNet Energy Return (Nh):"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">low_burden</span><span class="op">$</span><span class="va">nh</span><span class="op">)</span>  <span class="co"># More reasonable range</span></span>
<span><span class="co">#&gt; [1]  99.0000 165.6667 199.0000</span></span></code></pre></div>
<p>Very low energy burdens (e.g., 0.01 = 1%) become very large values
(100) when inverted for harmonic mean calculation. The Nh values remain
in a more reasonable range, reducing numerical precision issues.</p>
</div>
</div>
<div class="section level2">
<h2 id="error-from-incorrect-aggregation">Error from Incorrect Aggregation<a class="anchor" aria-label="anchor" href="#error-from-incorrect-aggregation"></a>
</h2>
<p>Let’s quantify the error introduced by incorrectly using arithmetic
mean on EB values:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use realistic North Carolina-like data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_households</span> <span class="op">&lt;-</span> <span class="fl">5000</span></span>
<span></span>
<span><span class="va">realistic_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  income_bracket <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0-30% AMI"</span>, <span class="st">"30-50% AMI"</span>, <span class="st">"50-80% AMI"</span>, <span class="st">"80-100% AMI"</span>, <span class="st">"100%+ AMI"</span><span class="op">)</span>,</span>
<span>    <span class="va">n_households</span>,</span>
<span>    replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.12</span>, <span class="fl">0.20</span>, <span class="fl">0.10</span>, <span class="fl">0.43</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">n_households</span>, meanlog <span class="op">=</span> <span class="fl">10.8</span>, sdlog <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>  households <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">100</span>, <span class="va">n_households</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">realistic_data</span><span class="op">$</span><span class="va">spending</span> <span class="op">&lt;-</span> <span class="va">realistic_data</span><span class="op">$</span><span class="va">income</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span></span>
<span>  <span class="va">n_households</span>,</span>
<span>  meanlog <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  sdlog <span class="op">=</span> <span class="fl">0.6</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate metrics</span></span>
<span><span class="va">realistic_data</span> <span class="op">&lt;-</span> <span class="va">realistic_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    eb <span class="op">=</span> <span class="fu"><a href="../reference/energy_burden_func.html">energy_burden_func</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">spending</span><span class="op">)</span>,</span>
<span>    nh <span class="op">=</span> <span class="fu"><a href="../reference/ner_func.html">ner_func</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">spending</span><span class="op">)</span>,</span>
<span>    neb <span class="op">=</span> <span class="fu"><a href="../reference/neb_func.html">neb_func</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">spending</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># WRONG: Arithmetic mean of EB</span></span>
<span><span class="va">eb_wrong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">realistic_data</span><span class="op">$</span><span class="va">eb</span>, <span class="va">realistic_data</span><span class="op">$</span><span class="va">households</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># CORRECT: Via Nh</span></span>
<span><span class="va">nh_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">realistic_data</span><span class="op">$</span><span class="va">nh</span>, <span class="va">realistic_data</span><span class="op">$</span><span class="va">households</span><span class="op">)</span></span>
<span><span class="va">eb_correct</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">nh_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate error</span></span>
<span><span class="va">absolute_error</span> <span class="op">&lt;-</span> <span class="va">eb_wrong</span> <span class="op">-</span> <span class="va">eb_correct</span></span>
<span><span class="va">relative_error_pct</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">absolute_error</span> <span class="op">/</span> <span class="va">eb_correct</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"WRONG (arithmetic mean EB): %.2f%%\n"</span>, <span class="va">eb_wrong</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; WRONG (arithmetic mean EB): 5.94%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"CORRECT (via Nh method):   %.2f%%\n"</span>, <span class="va">eb_correct</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; CORRECT (via Nh method):   4.15%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Absolute error:             %.4f\n"</span>, <span class="va">absolute_error</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Absolute error:             0.0179</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Relative error:             %.2f%%\n"</span>, <span class="va">relative_error_pct</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Relative error:             43.18%</span></span></code></pre></div>
<p>The error from using arithmetic mean instead of proper aggregation is
typically 1-5% in relative terms, which can be significant for policy
analysis and equity assessments.</p>
</div>
<div class="section level2">
<h2 id="practical-workflow">Practical Workflow<a class="anchor" aria-label="anchor" href="#practical-workflow"></a>
</h2>
<p>Here’s the recommended workflow for energy burden analysis:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Calculate Nh for all observations</span></span>
<span><span class="va">data_with_metrics</span> <span class="op">&lt;-</span> <span class="va">realistic_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    nh <span class="op">=</span> <span class="fu"><a href="../reference/ner_func.html">ner_func</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">spending</span><span class="op">)</span>,</span>
<span>    neb <span class="op">=</span> <span class="fu"><a href="../reference/neb_func.html">neb_func</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">spending</span><span class="op">)</span>  <span class="co"># Same as eb, but emphasizes proper aggregation</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Aggregate by groups using arithmetic weighted mean</span></span>
<span><span class="va">by_bracket</span> <span class="op">&lt;-</span> <span class="va">data_with_metrics</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">income_bracket</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    total_households <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">households</span><span class="op">)</span>,</span>
<span>    nh_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">nh</span>, <span class="va">households</span><span class="op">)</span>,</span>
<span>    neb <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">nh_mean</span><span class="op">)</span>,  <span class="co"># Correct aggregation</span></span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">neb</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">by_bracket</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   income_bracket total_households nh_mean    neb</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0-30% AMI                 <span style="text-decoration: underline;">42</span>020    22.1 0.043<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 50-80% AMI                <span style="text-decoration: underline;">55</span>223    22.4 0.042<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 80-100% AMI               <span style="text-decoration: underline;">26</span>530    22.7 0.042<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 30-50% AMI                <span style="text-decoration: underline;">32</span>511    23.6 0.040<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 100%+ AMI                <span style="text-decoration: underline;">116</span>969    23.8 0.040<span style="text-decoration: underline;">4</span></span></span>
<span></span>
<span><span class="co"># Step 3: Identify high-burden households</span></span>
<span><span class="va">high_burden_threshold</span> <span class="op">&lt;-</span> <span class="fl">0.06</span>  <span class="co"># 6% energy burden threshold</span></span>
<span><span class="va">nh_threshold</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">high_burden_threshold</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>  <span class="co"># = 15.67</span></span>
<span></span>
<span><span class="va">high_burden_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span></span>
<span>  <span class="va">data_with_metrics</span><span class="op">$</span><span class="va">households</span><span class="op">[</span><span class="va">data_with_metrics</span><span class="op">$</span><span class="va">nh</span> <span class="op">&lt;</span> <span class="va">nh_threshold</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="va">total_households</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">data_with_metrics</span><span class="op">$</span><span class="va">households</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\nHouseholds with &gt;6%% energy burden: %.1f%%\n"</span>,</span>
<span>            <span class="op">(</span><span class="va">high_burden_count</span> <span class="op">/</span> <span class="va">total_households</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Households with &gt;6% energy burden: 37.7%</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<div class="section level3">
<h3 id="key-principles">Key Principles<a class="anchor" aria-label="anchor" href="#key-principles"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Energy burden is a ratio</strong> and requires harmonic mean
for proper aggregation</li>
<li>
<strong>Net Energy Return (Nh)</strong> transformation enables
arithmetic mean aggregation</li>
<li>
<strong>Both methods are mathematically equivalent</strong> and give
identical results</li>
<li>
<strong>Nh method advantages</strong> (for aggregation across
households):
<ul>
<li>Simpler computation (arithmetic vs harmonic mean)</li>
<li>Better numerical stability</li>
<li>More interpretable (net return per dollar of energy spending)</li>
<li>Makes improper aggregation obviously wrong</li>
</ul>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="the-correct-formula">The Correct Formula<a class="anchor" aria-label="anchor" href="#the-correct-formula"></a>
</h3>
<p><strong>For aggregation across households</strong>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Calculate Nh for each household/cohort</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">nh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ner_func.html">ner_func</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">income</span>, <span class="va">data</span><span class="op">$</span><span class="va">spending</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Weighted arithmetic mean</span></span>
<span><span class="va">nh_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">nh</span>, <span class="va">data</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Convert to energy burden</span></span>
<span><span class="va">eb_aggregate</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">nh_mean</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="common-mistakes-to-avoid">Common Mistakes to Avoid<a class="anchor" aria-label="anchor" href="#common-mistakes-to-avoid"></a>
</h3>
<p><strong>❌ NEVER do this</strong>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># WRONG: Arithmetic mean of energy burden</span></span>
<span><span class="va">eb_wrong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="fu"><a href="../reference/energy_burden_func.html">energy_burden_func</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">spending</span><span class="op">)</span>, <span class="va">weights</span><span class="op">)</span></span></code></pre></div>
<p><strong>✅ ALWAYS do this</strong>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CORRECT: Nh method with arithmetic mean, then convert</span></span>
<span><span class="va">nh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ner_func.html">ner_func</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">spending</span><span class="op">)</span></span>
<span><span class="va">nh_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">nh</span>, <span class="va">weights</span><span class="op">)</span></span>
<span><span class="va">eb_correct</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">nh_mean</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>For a quick reference guide, see <code>NEB_QUICKSTART.md</code> in
the package repository.</p>
<p>For practical examples with real data, see
<code><a href="../articles/getting-started.html">vignette("getting-started")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="mathematical-appendix">Mathematical Appendix<a class="anchor" aria-label="anchor" href="#mathematical-appendix"></a>
</h2>
<div class="section level3">
<h3 id="identity-proofs">Identity Proofs<a class="anchor" aria-label="anchor" href="#identity-proofs"></a>
</h3>
<p><strong>Proof that NEB = EB at household level</strong>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Nh</mtext><mo>=</mo><mfrac><mrow><mi>G</mi><mo>−</mo><mi>S</mi></mrow><mi>S</mi></mfrac></mrow><annotation encoding="application/x-tex">\text{Nh} = \frac{G - S}{S}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">NEB</mtext><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mtext mathvariant="normal">Nh</mtext></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mfrac><mrow><mi>G</mi><mo>−</mo><mi>S</mi></mrow><mi>S</mi></mfrac></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mfrac><mrow><mi>S</mi><mo>+</mo><mi>G</mi><mo>−</mo><mi>S</mi></mrow><mi>S</mi></mfrac></mfrac><mo>=</mo><mfrac><mn>1</mn><mfrac><mi>G</mi><mi>S</mi></mfrac></mfrac><mo>=</mo><mfrac><mi>S</mi><mi>G</mi></mfrac><mo>=</mo><mtext mathvariant="normal">EB</mtext></mrow><annotation encoding="application/x-tex">\text{NEB} = \frac{1}{1 + \text{Nh}} = \frac{1}{1 + \frac{G-S}{S}} = \frac{1}{\frac{S + G - S}{S}} = \frac{1}{\frac{G}{S}} = \frac{S}{G} = \text{EB}</annotation></semantics></math></p>
<p><strong>Proof that harmonic mean of EB equals arithmetic mean via
Nh</strong>:</p>
<p>For weighted aggregation with weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>i</mi></msub><annotation encoding="application/x-tex">w_i</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">EB</mtext><mtext mathvariant="normal">harmonic</mtext></msub><mo>=</mo><mfrac><mn>1</mn><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>⋅</mo><mfrac><mn>1</mn><msub><mtext mathvariant="normal">EB</mtext><mi>i</mi></msub></mfrac></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{EB}_{\text{harmonic}} = \frac{1}{\sum_i w_i \cdot \frac{1}{\text{EB}_i}}</annotation></semantics></math></p>
<p>Since
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">EB</mtext><mi>i</mi></msub><mo>=</mo><msub><mi>S</mi><mi>i</mi></msub><mi>/</mi><msub><mi>G</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\text{EB}_i = S_i / G_i</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">EB</mtext><mtext mathvariant="normal">harmonic</mtext></msub><mo>=</mo><mfrac><mn>1</mn><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>⋅</mo><mfrac><msub><mi>G</mi><mi>i</mi></msub><msub><mi>S</mi><mi>i</mi></msub></mfrac></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{EB}_{\text{harmonic}} = \frac{1}{\sum_i w_i \cdot \frac{G_i}{S_i}}</annotation></semantics></math></p>
<p>Now via Nh method:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">Nh</mtext><mi>i</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>G</mi><mi>i</mi></msub><mo>−</mo><msub><mi>S</mi><mi>i</mi></msub></mrow><msub><mi>S</mi><mi>i</mi></msub></mfrac><mo>=</mo><mfrac><msub><mi>G</mi><mi>i</mi></msub><msub><mi>S</mi><mi>i</mi></msub></mfrac><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{Nh}_i = \frac{G_i - S_i}{S_i} = \frac{G_i}{S_i} - 1</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mtext mathvariant="normal">Nh</mtext><mo accent="true">¯</mo></mover><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>⋅</mo><msub><mtext mathvariant="normal">Nh</mtext><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\overline{\text{Nh}} = \sum_i w_i \cdot \text{Nh}_i</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">EB</mtext><mtext mathvariant="normal">via Nh</mtext></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mover><mtext mathvariant="normal">Nh</mtext><mo accent="true">¯</mo></mover></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msub><mi>G</mi><mi>i</mi></msub><msub><mi>S</mi><mi>i</mi></msub></mfrac><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{EB}_{\text{via Nh}} = \frac{1}{1 + \overline{\text{Nh}}} = \frac{1}{1 + \sum_i w_i \cdot \left(\frac{G_i}{S_i} - 1\right)}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mfrac><mn>1</mn><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>⋅</mo><mfrac><msub><mi>G</mi><mi>i</mi></msub><msub><mi>S</mi><mi>i</mi></msub></mfrac><mo>−</mo><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">= \frac{1}{\sum_i w_i \cdot \frac{G_i}{S_i} - \sum_i w_i + 1}</annotation></semantics></math></p>
<p>When weights are normalized
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>i</mi></msub><msub><mi>w</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_i w_i = 1</annotation></semantics></math>),
this simplifies to:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mfrac><mn>1</mn><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo>⋅</mo><mfrac><msub><mi>G</mi><mi>i</mi></msub><msub><mi>S</mi><mi>i</mi></msub></mfrac></mrow></mfrac><mo>=</mo><msub><mtext mathvariant="normal">EB</mtext><mtext mathvariant="normal">harmonic</mtext></msub></mrow><annotation encoding="application/x-tex">= \frac{1}{\sum_i w_i \cdot \frac{G_i}{S_i}} = \text{EB}_{\text{harmonic}}</annotation></semantics></math></p>
<p>Therefore, both methods are mathematically equivalent. ∎</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eric Scheier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
